from unittest import TestCase, mock
from alert_on_rain.alert_on_rain_tomorrow_runner import *
import requests_mock
from io import StringIO
import sys


class BaseTests(TestCase):

    def test_alert_on_rain_tomorrow_init_alert_on_rain(self):
        with requests_mock.Mocker() as request_mocker:
            request_mocker.post('https://api.telegram.org/botmy_totally_real_telegram_token/sendMessage?chat_id=123&'
                                'text=Subject%3A+Rain+tomorrow%0A%0A++++++++++++This+message+is+to+alert+you+it+looks'
                                '+like+it+will+rain+tomorrow.%0A++++++++++++',
                                status_code=200, text='{"ok":true,"result":{"message_id":85,"from":{"id":123,'
                                                      '"is_bot":true,"first_name":"blabla",'
                                                      '"username":"blablason"},"chat":{'
                                                      '"id":123,"first_name":"blabla","last_name":"son",'
                                                      '"username":"Naorlivne","type":"private"},"date":123,'
                                                      '"text":"test api is working"}}')
            request_mocker.get('https://api.openweathermap.org/data/2.5/forecast?APPID=my_super_secret_token123&'
                               'lang=en&q=Tel+Aviv%2CIL', text='{"cod":"200","message":0,"cnt":40,'
                                                               '"list":[{"dt":1608811200,'
                                                               '"main":{"temp":289.62,'
                                                               '"feels_like":287.41,'
                                                               '"temp_min":289.62,"temp_max":291.17,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1013,"humidity":71,'
                                                               '"temp_kf":-1.55},"weather":[{'
                                                               '"id":500,"main":"Rain",'
                                                               '"description":"light rain",'
                                                               '"icon":"10d"}],"clouds":{"all":58},'
                                                               '"wind":{"speed":3.7,"deg":338},'
                                                               '"visibility":10000,"pop":0.24,'
                                                               '"rain":{"3h":0.48},'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-24 12:00:00"},'
                                                               '{"dt":1608822000,'
                                                               '"main":{"temp":288.89,'
                                                               '"feels_like":286.74,'
                                                               '"temp_min":288.89,"temp_max":289.1,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":67,'
                                                               '"temp_kf":-0.21},"weather":[{'
                                                               '"id":500,"main":"Rain",'
                                                               '"description":"light rain",'
                                                               '"icon":"10n"}],"clouds":{"all":26},'
                                                               '"wind":{"speed":3,"deg":5},'
                                                               '"visibility":10000,"pop":0.3,'
                                                               '"rain":{"3h":0.18},'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 15:00:00"},'
                                                               '{"dt":1608832800,'
                                                               '"main":{"temp":287.98,'
                                                               '"feels_like":286.06,'
                                                               '"temp_min":287.97,"temp_max":287.98,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":64,'
                                                               '"temp_kf":0.01},"weather":[{'
                                                               '"id":801,"main":"Rain",'
                                                               '"description":"few clouds",'
                                                               '"icon":"02n"}],"clouds":{"all":19},'
                                                               '"wind":{"speed":2.11,"deg":47},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 18:00:00"},'
                                                               '{"dt":1608843600,'
                                                               '"main":{"temp":287.32,'
                                                               '"feels_like":285.64,'
                                                               '"temp_min":287.31,"temp_max":287.32,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":63,'
                                                               '"temp_kf":0.01},"weather":[{'
                                                               '"id":801,"main":"Rain",'
                                                               '"description":"few clouds",'
                                                               '"icon":"02n"}],"clouds":{"all":11},'
                                                               '"wind":{"speed":1.47,"deg":62},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 21:00:00"},'
                                                               '{"dt":1608854400,'
                                                               '"main":{"temp":286.63,'
                                                               '"feels_like":284.12,'
                                                               '"temp_min":286.63,"temp_max":286.63,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":65,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":5},'
                                                               '"wind":{"speed":2.6,"deg":60},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 00:00:00"},'
                                                               '{"dt":1608865200,'
                                                               '"main":{"temp":285.77,'
                                                               '"feels_like":282.78,'
                                                               '"temp_min":285.77,"temp_max":285.77,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":66,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.1,"deg":65},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 03:00:00"},'
                                                               '{"dt":1608876000,'
                                                               '"main":{"temp":286.69,'
                                                               '"feels_like":283.24,'
                                                               '"temp_min":286.69,"temp_max":286.69,'
                                                               '"pressure":1022,"sea_level":1022,'
                                                               '"grnd_level":1017,"humidity":63,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.81,"deg":74},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 06:00:00"},'
                                                               '{"dt":1608886500 ,'
                                                               '"main":{"temp":290.47,'
                                                               '"feels_like":287.27,'
                                                               '"temp_min":290.47,"temp_max":290.47,'
                                                               '"pressure":1022,"sea_level":1022,'
                                                               '"grnd_level":1017,"humidity":52,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.7,"deg":80},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 09:00:00"},'
                                                               '{"dt":1608897600,'
                                                               '"main":{"temp":292.02,'
                                                               '"feels_like":288.88,'
                                                               '"temp_min":292.02,"temp_max":292.02,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.49,"deg":56},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 12:00:00"},'
                                                               '{"dt":1608908400,'
                                                               '"main":{"temp":289.38,'
                                                               '"feels_like":285.36,'
                                                               '"temp_min":289.38,"temp_max":289.38,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":56,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.89,"deg":42},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 15:00:00"},'
                                                               '{"dt":1608919200,'
                                                               '"main":{"temp":288.39,'
                                                               '"feels_like":283.78,'
                                                               '"temp_min":288.39,"temp_max":288.39,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":58,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.59,"deg":52},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 18:00:00"},'
                                                               '{"dt":1608930000,'
                                                               '"main":{"temp":287.78,'
                                                               '"feels_like":283.04,'
                                                               '"temp_min":287.78,"temp_max":287.78,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":57,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.52,"deg":67},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 21:00:00"},'
                                                               '{"dt":1608940500 ,'
                                                               '"main":{"temp":287.21,'
                                                               '"feels_like":282.47,'
                                                               '"temp_min":287.21,"temp_max":287.21,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":58,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.44,"deg":77},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 00:00:00"},'
                                                               '{"dt":1608951600,'
                                                               '"main":{"temp":286.64,'
                                                               '"feels_like":281.28,'
                                                               '"temp_min":286.64,"temp_max":286.64,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":59,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.23,"deg":84},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 03:00:00"},'
                                                               '{"dt":1608962400,'
                                                               '"main":{"temp":287.14,'
                                                               '"feels_like":280.89,'
                                                               '"temp_min":287.14,"temp_max":287.14,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":53,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.2,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 06:00:00"},'
                                                               '{"dt":1608973200,'
                                                               '"main":{"temp":290.96,'
                                                               '"feels_like":284.43,'
                                                               '"temp_min":290.96,"temp_max":290.96,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":42,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.64,"deg":91},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 09:00:00"},'
                                                               '{"dt":1608984000,'
                                                               '"main":{"temp":292.29,'
                                                               '"feels_like":286.2,'
                                                               '"temp_min":292.29,"temp_max":292.29,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":39,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.05,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 12:00:00"},'
                                                               '{"dt":1608994500 ,'
                                                               '"main":{"temp":289.28,'
                                                               '"feels_like":284.28,'
                                                               '"temp_min":289.28,"temp_max":289.28,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":45,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.31,"deg":75},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 15:00:00"},'
                                                               '{"dt":1609005600,'
                                                               '"main":{"temp":288.88,'
                                                               '"feels_like":283.11,'
                                                               '"temp_min":288.88,"temp_max":288.88,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":43,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.14,"deg":76},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 18:00:00"},'
                                                               '{"dt":1609016400,'
                                                               '"main":{"temp":288.1,'
                                                               '"feels_like":282.18,'
                                                               '"temp_min":288.1,"temp_max":288.1,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.42,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 21:00:00"},'
                                                               '{"dt":1609027200,'
                                                               '"main":{"temp":287.47,'
                                                               '"feels_like":281.31,'
                                                               '"temp_min":287.47,"temp_max":287.47,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":48,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.77,"deg":86},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 00:00:00"},'
                                                               '{"dt":1609038000,'
                                                               '"main":{"temp":286.86,'
                                                               '"feels_like":281.01,'
                                                               '"temp_min":286.86,"temp_max":286.86,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":49,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.26,"deg":89},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 03:00:00"},'
                                                               '{"dt":1609048500 ,'
                                                               '"main":{"temp":287.48,'
                                                               '"feels_like":281.18,'
                                                               '"temp_min":287.48,"temp_max":287.48,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.9,"deg":93},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 06:00:00"},'
                                                               '{"dt":1609059600,'
                                                               '"main":{"temp":292.2,'
                                                               '"feels_like":286.62,'
                                                               '"temp_min":292.2,"temp_max":292.2,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":44,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.82,"deg":102},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 09:00:00"},'
                                                               '{"dt":1609070400,'
                                                               '"main":{"temp":293.27,'
                                                               '"feels_like":288.44,'
                                                               '"temp_min":293.27,"temp_max":293.27,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.28,"deg":96},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 12:00:00"},'
                                                               '{"dt":1609081200,'
                                                               '"main":{"temp":290.13,'
                                                               '"feels_like":285.51,'
                                                               '"temp_min":290.13,"temp_max":290.13,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":54,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.8,"deg":81},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 15:00:00"},'
                                                               '{"dt":1609092000,'
                                                               '"main":{"temp":288.9,'
                                                               '"feels_like":283.69,'
                                                               '"temp_min":288.9,"temp_max":288.9,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":49,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.86,"deg":90},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 18:00:00"},'
                                                               '{"dt":1609102500 ,'
                                                               '"main":{"temp":288.78,'
                                                               '"feels_like":282.2,'
                                                               '"temp_min":288.78,"temp_max":288.78,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":801,'
                                                               '"main":"Clouds","description":"few '
                                                               'clouds","icon":"02n"}],'
                                                               '"clouds":{"all":15},'
                                                               '"wind":{"speed":7.53,"deg":101},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 21:00:00"},'
                                                               '{"dt":1609113600,'
                                                               '"main":{"temp":287.99,'
                                                               '"feels_like":281.17,'
                                                               '"temp_min":287.99,"temp_max":287.99,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":802,'
                                                               '"main":"Clouds",'
                                                               '"description":"scattered clouds",'
                                                               '"icon":"03n"}],"clouds":{"all":34},'
                                                               '"wind":{"speed":7.76,"deg":93},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 00:00:00"},'
                                                               '{"dt":1609124400,'
                                                               '"main":{"temp":287.36,'
                                                               '"feels_like":280.89,'
                                                               '"temp_min":287.36,"temp_max":287.36,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":52,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":70},'
                                                               '"wind":{"speed":7.5,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 03:00:00"},'
                                                               '{"dt":1609135200,'
                                                               '"main":{"temp":287.38,'
                                                               '"feels_like":281.92,'
                                                               '"temp_min":287.38,"temp_max":287.38,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":57,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":71},'
                                                               '"wind":{"speed":6.43,"deg":88},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 06:00:00"},'
                                                               '{"dt":1609146000,'
                                                               '"main":{"temp":291.66,'
                                                               '"feels_like":287.25,'
                                                               '"temp_min":291.66,"temp_max":291.66,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":48,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":78},'
                                                               '"wind":{"speed":5.39,"deg":97},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 09:00:00"},'
                                                               '{"dt":1609156500 ,'
                                                               '"main":{"temp":292.71,'
                                                               '"feels_like":288.66,'
                                                               '"temp_min":292.71,"temp_max":292.71,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":89},'
                                                               '"wind":{"speed":5.1,"deg":100},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 12:00:00"},'
                                                               '{"dt":1609167600,'
                                                               '"main":{"temp":289.86,'
                                                               '"feels_like":286.45,'
                                                               '"temp_min":289.86,"temp_max":289.86,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":55,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":100},'
                                                               '"wind":{"speed":4.08,"deg":74},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 15:00:00"},'
                                                               '{"dt":1609178400,'
                                                               '"main":{"temp":289.28,'
                                                               '"feels_like":284.7,'
                                                               '"temp_min":289.28,"temp_max":289.28,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":53,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":100},'
                                                               '"wind":{"speed":5.4,"deg":84},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 18:00:00"},'
                                                               '{"dt":1609189200,'
                                                               '"main":{"temp":288.99,'
                                                               '"feels_like":284.12,'
                                                               '"temp_min":288.99,"temp_max":288.99,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":50,'
                                                               '"temp_kf":0},"weather":[{"id":802,'
                                                               '"main":"Clouds",'
                                                               '"description":"scattered clouds",'
                                                               '"icon":"03n"}],"clouds":{"all":27},'
                                                               '"wind":{"speed":5.47,"deg":94},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 21:00:00"},'
                                                               '{"dt":1609200000,'
                                                               '"main":{"temp":288.29,'
                                                               '"feels_like":283.38,'
                                                               '"temp_min":288.29,"temp_max":288.29,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":51,'
                                                               '"temp_kf":0},"weather":[{"id":801,'
                                                               '"main":"Clouds","description":"few '
                                                               'clouds","icon":"02n"}],'
                                                               '"clouds":{"all":14},'
                                                               '"wind":{"speed":5.43,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-29 00:00:00"},'
                                                               '{"dt":1609210500 ,'
                                                               '"main":{"temp":287.41,'
                                                               '"feels_like":283.21,'
                                                               '"temp_min":287.41,"temp_max":287.41,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":54,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.42,"deg":85},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-29 03:00:00"},'
                                                               '{"dt":1609221600,'
                                                               '"main":{"temp":288.15,'
                                                               '"feels_like":283.84,'
                                                               '"temp_min":288.15,"temp_max":288.15,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":55,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.86,"deg":86},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-29 06:00:00"},'
                                                               '{"dt":1609232400,'
                                                               '"main":{"temp":292.9,'
                                                               '"feels_like":288.65,'
                                                               '"temp_min":292.9,"temp_max":292.9,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":43,'
                                                               '"temp_kf":0},"weather":[{"id":500 ,'
                                                               '"main":"Rain","description":"Rain '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.01,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-29 09:00:00"}],'
                                                               '"city":{"id":294492,"name":"Kfar '
                                                               'Yona","coord":{"lat":32.32,'
                                                               '"lon":34.94},"country":"IL",'
                                                               '"population":13320,"timezone":7200,'
                                                               '"sunrise":1608784741,'
                                                               '"sunset":1608820843}}')
            with mock.patch('os.environ', {
                "OWM_API_KEY": "my_super_secret_token123",
                "CITY": "Tel Aviv",
                "COUNTRY_CODE": "IL",
                "SMTP_SERVER": "localhost",
                "SENDER_EMAIL": "email@test.com",
                "RECEIVER_EMAIL": "email@test.com",
                "EMAIL_PASSWORD": "password",
                "EMAIL_PORT": "1025",
                "TELEGRAM_TOKEN": "my_totally_real_telegram_token",
                "CHAT_ID": "123"

            }):
                with mock.patch("smtplib.SMTP_SSL"):
                    old_stdout = sys.stdout
                    result = StringIO()
                    sys.stdout = result
                    init()
                    sys.stdout = old_stdout
                    result_string = result.getvalue()
                    self.assertEqual(result_string, "It will rain tomorrow, sending alert\nrain alert sent\n")

    def test_alert_on_rain_tomorrow_init_do_not_alert_on_no_rain(self):
        with requests_mock.Mocker() as request_mocker:
            request_mocker.post('https://api.telegram.org/botmy_totally_real_telegram_token/sendMessage?chat_id=123&'
                                'text=Subject%3A+Rain+tomorrow%0A%0A++++++++++++This+message+is+to+alert+you+it+looks'
                                '+like+it+will+rain+tomorrow.%0A++++++++++++',
                                status_code=200, text='{"ok":true,"result":{"message_id":85,"from":{"id":123,'
                                                      '"is_bot":true,"first_name":"blabla",'
                                                      '"username":"blablason"},"chat":{'
                                                      '"id":123,"first_name":"blabla","last_name":"son",'
                                                      '"username":"Naorlivne","type":"private"},"date":123,'
                                                      '"text":"test api is working"}}')
            request_mocker.get('https://api.openweathermap.org/data/2.5/forecast?APPID=my_super_secret_token123&'
                               'lang=en&q=Tel+Aviv%2CIL', text='{"cod":"200","message":0,"cnt":40,'
                                                               '"list":[{"dt":1608811200,'
                                                               '"main":{"temp":289.62,'
                                                               '"feels_like":287.41,'
                                                               '"temp_min":289.62,"temp_max":291.17,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1013,"humidity":71,'
                                                               '"temp_kf":-1.55},"weather":[{'
                                                               '"id":500,"main":"Rain",'
                                                               '"description":"light rain",'
                                                               '"icon":"10d"}],"clouds":{"all":58},'
                                                               '"wind":{"speed":3.7,"deg":338},'
                                                               '"visibility":10000,"pop":0.24,'
                                                               '"rain":{"3h":0.48},'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-24 12:00:00"},'
                                                               '{"dt":1608822000,'
                                                               '"main":{"temp":288.89,'
                                                               '"feels_like":286.74,'
                                                               '"temp_min":288.89,"temp_max":289.1,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":67,'
                                                               '"temp_kf":-0.21},"weather":[{'
                                                               '"id":500,"main":"Rain",'
                                                               '"description":"light rain",'
                                                               '"icon":"10n"}],"clouds":{"all":26},'
                                                               '"wind":{"speed":3,"deg":5},'
                                                               '"visibility":10000,"pop":0.3,'
                                                               '"rain":{"3h":0.18},'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 15:00:00"},'
                                                               '{"dt":1608832800,'
                                                               '"main":{"temp":287.98,'
                                                               '"feels_like":286.06,'
                                                               '"temp_min":287.97,"temp_max":287.98,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":64,'
                                                               '"temp_kf":0.01},"weather":[{'
                                                               '"id":801,"main":"Clouds",'
                                                               '"description":"few clouds",'
                                                               '"icon":"02n"}],"clouds":{"all":19},'
                                                               '"wind":{"speed":2.11,"deg":47},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 18:00:00"},'
                                                               '{"dt":1608843600,'
                                                               '"main":{"temp":287.32,'
                                                               '"feels_like":285.64,'
                                                               '"temp_min":287.31,"temp_max":287.32,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":63,'
                                                               '"temp_kf":0.01},"weather":[{'
                                                               '"id":801,"main":"Clouds",'
                                                               '"description":"few clouds",'
                                                               '"icon":"02n"}],"clouds":{"all":11},'
                                                               '"wind":{"speed":1.47,"deg":62},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-24 21:00:00"},'
                                                               '{"dt":1608854400,'
                                                               '"main":{"temp":286.63,'
                                                               '"feels_like":284.12,'
                                                               '"temp_min":286.63,"temp_max":286.63,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":65,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":5},'
                                                               '"wind":{"speed":2.6,"deg":60},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 00:00:00"},'
                                                               '{"dt":1608865200,'
                                                               '"main":{"temp":285.77,'
                                                               '"feels_like":282.78,'
                                                               '"temp_min":285.77,"temp_max":285.77,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":66,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.1,"deg":65},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 03:00:00"},'
                                                               '{"dt":1608876000,'
                                                               '"main":{"temp":286.69,'
                                                               '"feels_like":283.24,'
                                                               '"temp_min":286.69,"temp_max":286.69,'
                                                               '"pressure":1022,"sea_level":1022,'
                                                               '"grnd_level":1017,"humidity":63,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.81,"deg":74},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 06:00:00"},'
                                                               '{"dt":1608886800,'
                                                               '"main":{"temp":290.47,'
                                                               '"feels_like":287.27,'
                                                               '"temp_min":290.47,"temp_max":290.47,'
                                                               '"pressure":1022,"sea_level":1022,'
                                                               '"grnd_level":1017,"humidity":52,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.7,"deg":80},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 09:00:00"},'
                                                               '{"dt":1608897600,'
                                                               '"main":{"temp":292.02,'
                                                               '"feels_like":288.88,'
                                                               '"temp_min":292.02,"temp_max":292.02,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":3.49,"deg":56},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-25 12:00:00"},'
                                                               '{"dt":1608908400,'
                                                               '"main":{"temp":289.38,'
                                                               '"feels_like":285.36,'
                                                               '"temp_min":289.38,"temp_max":289.38,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":56,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.89,"deg":42},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 15:00:00"},'
                                                               '{"dt":1608919200,'
                                                               '"main":{"temp":288.39,'
                                                               '"feels_like":283.78,'
                                                               '"temp_min":288.39,"temp_max":288.39,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":58,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.59,"deg":52},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 18:00:00"},'
                                                               '{"dt":1608930000,'
                                                               '"main":{"temp":287.78,'
                                                               '"feels_like":283.04,'
                                                               '"temp_min":287.78,"temp_max":287.78,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":57,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.52,"deg":67},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-25 21:00:00"},'
                                                               '{"dt":1608940800,'
                                                               '"main":{"temp":287.21,'
                                                               '"feels_like":282.47,'
                                                               '"temp_min":287.21,"temp_max":287.21,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":58,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.44,"deg":77},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 00:00:00"},'
                                                               '{"dt":1608951600,'
                                                               '"main":{"temp":286.64,'
                                                               '"feels_like":281.28,'
                                                               '"temp_min":286.64,"temp_max":286.64,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":59,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.23,"deg":84},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 03:00:00"},'
                                                               '{"dt":1608962400,'
                                                               '"main":{"temp":287.14,'
                                                               '"feels_like":280.89,'
                                                               '"temp_min":287.14,"temp_max":287.14,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":53,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.2,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 06:00:00"},'
                                                               '{"dt":1608973200,'
                                                               '"main":{"temp":290.96,'
                                                               '"feels_like":284.43,'
                                                               '"temp_min":290.96,"temp_max":290.96,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":42,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.64,"deg":91},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 09:00:00"},'
                                                               '{"dt":1608984000,'
                                                               '"main":{"temp":292.29,'
                                                               '"feels_like":286.2,'
                                                               '"temp_min":292.29,"temp_max":292.29,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":39,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":7.05,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-26 12:00:00"},'
                                                               '{"dt":1608994800,'
                                                               '"main":{"temp":289.28,'
                                                               '"feels_like":284.28,'
                                                               '"temp_min":289.28,"temp_max":289.28,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":45,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.31,"deg":75},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 15:00:00"},'
                                                               '{"dt":1609005600,'
                                                               '"main":{"temp":288.88,'
                                                               '"feels_like":283.11,'
                                                               '"temp_min":288.88,"temp_max":288.88,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":43,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.14,"deg":76},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 18:00:00"},'
                                                               '{"dt":1609016400,'
                                                               '"main":{"temp":288.1,'
                                                               '"feels_like":282.18,'
                                                               '"temp_min":288.1,"temp_max":288.1,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.42,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-26 21:00:00"},'
                                                               '{"dt":1609027200,'
                                                               '"main":{"temp":287.47,'
                                                               '"feels_like":281.31,'
                                                               '"temp_min":287.47,"temp_max":287.47,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":48,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.77,"deg":86},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 00:00:00"},'
                                                               '{"dt":1609038000,'
                                                               '"main":{"temp":286.86,'
                                                               '"feels_like":281.01,'
                                                               '"temp_min":286.86,"temp_max":286.86,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":49,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.26,"deg":89},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 03:00:00"},'
                                                               '{"dt":1609048800,'
                                                               '"main":{"temp":287.48,'
                                                               '"feels_like":281.18,'
                                                               '"temp_min":287.48,"temp_max":287.48,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.9,"deg":93},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 06:00:00"},'
                                                               '{"dt":1609059600,'
                                                               '"main":{"temp":292.2,'
                                                               '"feels_like":286.62,'
                                                               '"temp_min":292.2,"temp_max":292.2,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":44,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.82,"deg":102},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 09:00:00"},'
                                                               '{"dt":1609070400,'
                                                               '"main":{"temp":293.27,'
                                                               '"feels_like":288.44,'
                                                               '"temp_min":293.27,"temp_max":293.27,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":6.28,"deg":96},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-27 12:00:00"},'
                                                               '{"dt":1609081200,'
                                                               '"main":{"temp":290.13,'
                                                               '"feels_like":285.51,'
                                                               '"temp_min":290.13,"temp_max":290.13,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":54,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.8,"deg":81},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 15:00:00"},'
                                                               '{"dt":1609092000,'
                                                               '"main":{"temp":288.9,'
                                                               '"feels_like":283.69,'
                                                               '"temp_min":288.9,"temp_max":288.9,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":49,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.86,"deg":90},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 18:00:00"},'
                                                               '{"dt":1609102800,'
                                                               '"main":{"temp":288.78,'
                                                               '"feels_like":282.2,'
                                                               '"temp_min":288.78,"temp_max":288.78,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":46,'
                                                               '"temp_kf":0},"weather":[{"id":801,'
                                                               '"main":"Clouds","description":"few '
                                                               'clouds","icon":"02n"}],'
                                                               '"clouds":{"all":15},'
                                                               '"wind":{"speed":7.53,"deg":101},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-27 21:00:00"},'
                                                               '{"dt":1609113600,'
                                                               '"main":{"temp":287.99,'
                                                               '"feels_like":281.17,'
                                                               '"temp_min":287.99,"temp_max":287.99,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":802,'
                                                               '"main":"Clouds",'
                                                               '"description":"scattered clouds",'
                                                               '"icon":"03n"}],"clouds":{"all":34},'
                                                               '"wind":{"speed":7.76,"deg":93},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 00:00:00"},'
                                                               '{"dt":1609124400,'
                                                               '"main":{"temp":287.36,'
                                                               '"feels_like":280.89,'
                                                               '"temp_min":287.36,"temp_max":287.36,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":52,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":70},'
                                                               '"wind":{"speed":7.5,"deg":92},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 03:00:00"},'
                                                               '{"dt":1609135200,'
                                                               '"main":{"temp":287.38,'
                                                               '"feels_like":281.92,'
                                                               '"temp_min":287.38,"temp_max":287.38,'
                                                               '"pressure":1021,"sea_level":1021,'
                                                               '"grnd_level":1016,"humidity":57,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":71},'
                                                               '"wind":{"speed":6.43,"deg":88},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 06:00:00"},'
                                                               '{"dt":1609146000,'
                                                               '"main":{"temp":291.66,'
                                                               '"feels_like":287.25,'
                                                               '"temp_min":291.66,"temp_max":291.66,'
                                                               '"pressure":1020,"sea_level":1020,'
                                                               '"grnd_level":1015,"humidity":48,'
                                                               '"temp_kf":0},"weather":[{"id":803,'
                                                               '"main":"Clouds",'
                                                               '"description":"broken clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":78},'
                                                               '"wind":{"speed":5.39,"deg":97},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 09:00:00"},'
                                                               '{"dt":1609156800,'
                                                               '"main":{"temp":292.71,'
                                                               '"feels_like":288.66,'
                                                               '"temp_min":292.71,"temp_max":292.71,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":47,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04d"}],"clouds":{"all":89},'
                                                               '"wind":{"speed":5.1,"deg":100},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-28 12:00:00"},'
                                                               '{"dt":1609167600,'
                                                               '"main":{"temp":289.86,'
                                                               '"feels_like":286.45,'
                                                               '"temp_min":289.86,"temp_max":289.86,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":55,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":100},'
                                                               '"wind":{"speed":4.08,"deg":74},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 15:00:00"},'
                                                               '{"dt":1609178400,'
                                                               '"main":{"temp":289.28,'
                                                               '"feels_like":284.7,'
                                                               '"temp_min":289.28,"temp_max":289.28,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":53,'
                                                               '"temp_kf":0},"weather":[{"id":804,'
                                                               '"main":"Clouds",'
                                                               '"description":"overcast clouds",'
                                                               '"icon":"04n"}],"clouds":{"all":100},'
                                                               '"wind":{"speed":5.4,"deg":84},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 18:00:00"},'
                                                               '{"dt":1609189200,'
                                                               '"main":{"temp":288.99,'
                                                               '"feels_like":284.12,'
                                                               '"temp_min":288.99,"temp_max":288.99,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":50,'
                                                               '"temp_kf":0},"weather":[{"id":802,'
                                                               '"main":"Clouds",'
                                                               '"description":"scattered clouds",'
                                                               '"icon":"03n"}],"clouds":{"all":27},'
                                                               '"wind":{"speed":5.47,"deg":94},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-28 21:00:00"},'
                                                               '{"dt":1609200000,'
                                                               '"main":{"temp":288.29,'
                                                               '"feels_like":283.38,'
                                                               '"temp_min":288.29,"temp_max":288.29,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":51,'
                                                               '"temp_kf":0},"weather":[{"id":801,'
                                                               '"main":"Clouds","description":"few '
                                                               'clouds","icon":"02n"}],'
                                                               '"clouds":{"all":14},'
                                                               '"wind":{"speed":5.43,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-29 00:00:00"},'
                                                               '{"dt":1609210800,'
                                                               '"main":{"temp":287.41,'
                                                               '"feels_like":283.21,'
                                                               '"temp_min":287.41,"temp_max":287.41,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":54,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01n"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.42,"deg":85},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"n"},'
                                                               '"dt_txt":"2020-12-29 03:00:00"},'
                                                               '{"dt":1609221600,'
                                                               '"main":{"temp":288.15,'
                                                               '"feels_like":283.84,'
                                                               '"temp_min":288.15,"temp_max":288.15,'
                                                               '"pressure":1019,"sea_level":1019,'
                                                               '"grnd_level":1014,"humidity":55,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":4.86,"deg":86},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-29 06:00:00"},'
                                                               '{"dt":1609232400,'
                                                               '"main":{"temp":292.9,'
                                                               '"feels_like":288.65,'
                                                               '"temp_min":292.9,"temp_max":292.9,'
                                                               '"pressure":1018,"sea_level":1018,'
                                                               '"grnd_level":1013,"humidity":43,'
                                                               '"temp_kf":0},"weather":[{"id":800,'
                                                               '"main":"Clear","description":"clear '
                                                               'sky","icon":"01d"}],'
                                                               '"clouds":{"all":0},'
                                                               '"wind":{"speed":5.01,"deg":87},'
                                                               '"visibility":10000,"pop":0,'
                                                               '"sys":{"pod":"d"},'
                                                               '"dt_txt":"2020-12-29 09:00:00"}],'
                                                               '"city":{"id":294492,"name":"Kfar '
                                                               'Yona","coord":{"lat":32.32,'
                                                               '"lon":34.94},"country":"IL",'
                                                               '"population":13320,"timezone":7200,'
                                                               '"sunrise":1608784741,'
                                                               '"sunset":1608820843}}')
            with mock.patch('os.environ', {
                "OWM_API_KEY": "my_super_secret_token123",
                "CITY": "Tel Aviv",
                "COUNTRY_CODE": "IL",
                "SMTP_SERVER": "localhost",
                "SENDER_EMAIL": "email@test.com",
                "RECEIVER_EMAIL": "email@test.com",
                "EMAIL_PASSWORD": "password",
                "EMAIL_PORT": "1025",
                "TELEGRAM_TOKEN": "my_totally_real_telegram_token",
                "CHAT_ID": "123"

            }):
                old_stdout = sys.stdout
                result = StringIO()
                sys.stdout = result
                init()
                sys.stdout = old_stdout
                result_string = result.getvalue()
                self.assertEqual(result_string, "It will not rain tomorrow\n")
